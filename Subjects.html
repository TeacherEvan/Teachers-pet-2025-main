<!DOCTYPE html>
<html lang="en" spellcheck="false">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Select subjects and topics for comprehensive report generation">
    <title>üìö Subject Selection - Teachers Pet</title>

    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/css/components.css" as="style">
    <link rel="preload" href="assets/css/micro-interactions.css" as="style">
    <link rel="preload" href="assets/js/controllers/app-controller.js" as="script">
    <link rel="preload" href="assets/js/comment-engine.js" as="script">
    <link rel="preload" href="assets/js/curriculum/curriculum-loader.js" as="script">
    <link rel="preload" href="assets/js/utils/performance-optimizer.js" as="script">
    <link rel="preload" href="assets/js/utils/ui-enhancements.js" as="script">

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/micro-interactions.css">

    <!-- Curriculum Loader -->
    <script src="assets/js/curriculum/curriculum-loader.js"></script>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:
            url('https://images.unsplash.com/photo-1502134249126-9f3755a50d78?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover no-repeat fixed,
            radial-gradient(ellipse at center, rgba(30, 39, 70, 0.8) 0%, rgba(15, 15, 35, 0.9) 50%, rgba(0, 0, 0, 0.95) 100%);
        min-height: 100vh;
        padding: 20px;
        margin: 0;
        position: relative;
        overflow-x: hidden;
    }

    /* Space stars animation */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
            radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.8), transparent),
            radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.6), transparent),
            radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.5), transparent),
            radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.4), transparent),
            radial-gradient(2px 2px at 160px 30px, rgba(255, 255, 255, 0.7), transparent);
        background-repeat: repeat;
        background-size: 200px 200px;
        animation: twinkle 20s linear infinite;
        pointer-events: none;
        z-index: 1;
        will-change: transform, opacity;
    }

    @keyframes twinkle {
        0% {
            transform: translate3d(0px, 0px, 0) rotate(0deg);
            opacity: 0.8;
        }

        50% {
            opacity: 1;
        }

        100% {
            transform: translate3d(100px, -200px, 0) rotate(360deg);
            opacity: 0.8;
        }
    }

    .container {
        background: rgba(255, 255, 255, 0.3);
        -webkit-backdrop-filter: blur(20px);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        padding: 30px;
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
        z-index: 10;
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 50px rgba(255, 255, 255, 0.1);
    }

    .refresh-button {
        position: absolute;
        top: 20px;
        right: 20px;
        background-color: #27ae60;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    .refresh-button:hover {
        background-color: #229954;
    }

    .recommendation-button {
        position: absolute;
        top: 20px;
        right: 180px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .recommendation-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .recommendation-button:active {
        transform: translateY(0);
    }

    h1 {
        color: white;
        font-size: 2.2em;
        margin-bottom: 25px;
        font-weight: 600;
        text-align: center;
        font-family: 'Segoe UI', sans-serif;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .subject-section {
        margin-bottom: 15px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .subject-header {
        padding: 15px 20px;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .subject-header:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    .subject-title {
        font-size: 18px;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Segoe UI', sans-serif;
    }

    .topic-item {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 8px;
        border-radius: 6px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        gap: 10px;
    }

    .topic-text {
        flex: 1;
        color: white;
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
    }

    .dropdown-arrow {
        transition: transform 0.3s ease;
        color: white;
        margin-left: auto;
    }

    .dropdown-arrow.rotated {
        transform: rotate(180deg);
    }

    .dropdown-hint {
        font-size: 11px;
        color: #FFD700;
        margin-left: 10px;
        font-style: italic;
        opacity: 0.9;
        animation: pulsate-gold 2s ease-in-out infinite;
        font-weight: 400;
        text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
    }

    @keyframes pulsate-gold {

        0%,
        100% {
            opacity: 0.6;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.4);
        }

        50% {
            opacity: 1;
            text-shadow: 0 0 12px rgba(255, 215, 0, 0.8);
        }
    }

    .button {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        font-family: 'Segoe UI', sans-serif;
        margin: 8px 4px;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
    }

    .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }

    .button-success {
        background: linear-gradient(135deg, #27ae60, #229954);
        box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
    }

    .button-success:hover {
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    }

    .selection-summary {
        background: #f1f8ff;
        border: 1px solid #3498db;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #3498db;
        color: #2c3e50;
        font-family: 'Segoe UI', sans-serif;
    }

    /* bulk-actions toolbar removed */

    .comment-option {
        margin: 15px 0;
        padding: 15px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #2c3e50;
        font-family: 'Segoe UI', sans-serif;
    }

    .comment-option:hover {
        border-color: #3498db;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
    }

    .comment-option.selected {
        border-color: #27ae60;
        background: #f1f8ff;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
    }

    .navigation {
        text-align: center;
        margin: 25px 0;
        padding: 20px;
        border-top: 2px solid #e0e6ed;
    }

    .final-actions {
        margin-top: 20px;
        text-align: center;
        padding: 15px;
        border-top: 1px solid #e0e6ed;
    }

    .comments-section {
        margin-top: 25px;
        border-top: 2px solid #e0e6ed;
        padding-top: 25px;
    }

    .comment-box {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
        margin: 8px 0;
        min-height: 80px;
        border: 1px solid #e0e6ed;
        font-family: 'Segoe UI', sans-serif;
    }

    .subject-content {
        display: none !important;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        opacity: 0;
        transition: all 0.3s ease;
        max-height: 0;
        overflow: hidden;
    }

    .subject-content.active {
        display: block !important;
        opacity: 1;
        max-height: 1000px;
    }

    /* Additional debugging styles */
    .subject-content.active .topic-item {
        animation: fadeInUp 0.3s ease forwards;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px;
            margin: 10px;
        }

        h1 {
            font-size: 1.8em;
        }

        .subject-header {
            padding: 12px 15px;
        }

        .subject-title {
            font-size: 16px;
        }

        .topic-text {
            font-size: 13px;
        }

        .button {
            padding: 10px 20px;
            font-size: 13px;
            margin: 6px 3px;
        }

        .comment-option {
            padding: 12px;
            margin: 10px 0;
        }

        .comment-box {
            min-height: 60px;
            font-size: 13px;
        }
    }
</style>
<link rel="stylesheet" href="styles/inline-fixes.css">
</head>

<body>
    <div class="container">
        <button type="button" class="recommendation-button" onclick="ensureCommentGeneration()">‚ú® Make Recommendation</button>
        <button type="button" class="refresh-button" onclick="refreshReport()">üîÑ Refresh Report</button>
        <h1>Subject Selection</h1>
        <p class="text-center color-secondary margin-bottom-25 font-family-segoe">
            Select subjects and rate student performance (0-5 scale, 5 being excellent).
        </p>

        <!-- bulk-actions toolbar removed per UX request -->

        <div class="selection-summary">
            <strong>Selected Topics: </strong><span id="selectionCount">0</span>
        </div>

        <form id="subjectsForm">
            <!-- ENGLISH -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('english')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_english" value="English"
                            onchange="handleSubjectCheck('english')">
                        <label for="subject_english">ENGLISH</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_english">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_english">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english1"
                            value="draw lines to match letter with correct picture">
                        <label for="english1" class="topic-text">Draw lines to match letter with correct picture</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english2"
                            value="trace letters starting from the dot">
                        <label for="english2" class="topic-text">Trace letters starting from the dot</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english3"
                            value="draw lines to match the same letters">
                        <label for="english3" class="topic-text">Draw lines to match the same letters</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english4"
                            value="circle correct letter matching with pictures">
                        <label for="english4" class="topic-text">Circle correct letter matching with pictures</label>
                    </div>
                </div>
            </div>

            <!-- MATHEMATICS -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('mathematics')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_mathematics" value="Mathematics"
                            onchange="handleSubjectCheck('mathematics')">
                        <label for="subject_mathematics">MATHEMATICS</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_mathematics">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_mathematics">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math1" value="counting from 1 to 10">
                        <label for="math1" class="topic-text">Count from 1-10</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math2"
                            value="draw lines to match pictures with same number">
                        <label for="math2" class="topic-text">Draw lines to match pictures with same number</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math3"
                            value="mark picture with correct amount">
                        <label for="math3" class="topic-text">Mark picture with correct amount</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math4"
                            value="mark numbers that match with pictures">
                        <label for="math4" class="topic-text">Mark numbers that match with pictures</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math5" value="circle the correct amount">
                        <label for="math5" class="topic-text">Circle the correct amount</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math6"
                            value="trace numbers 1-5 following dotted line">
                        <label for="math6" class="topic-text">Trace numbers 1-5 following dotted line</label>
                    </div>
                </div>
            </div>

            <!-- I.Q -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('iq')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_iq" value="I.Q"
                            onchange="handleSubjectCheck('iq')">
                        <label for="subject_iq">I.Q</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_iq">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_iq">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq1" value="color pictures that are the same">
                        <label for="iq1" class="topic-text">Color pictures that are the same</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq2" value="color pictures that are fatter">
                        <label for="iq2" class="topic-text">Color pictures that are fatter</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq3" value="color the taller picture">
                        <label for="iq3" class="topic-text">Color the taller picture</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq4" value="color hot and cold items">
                        <label for="iq4" class="topic-text">Color hot and cold items</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq5"
                            value="color shape that is same as first">
                        <label for="iq5" class="topic-text">Color shape that is same as first</label>
                    </div>
                </div>
            </div>

            <!-- SOCIAL STUDIES -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('social')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_social" value="Social Studies"
                            onchange="handleSubjectCheck('social')">
                        <label for="subject_social">SOCIAL STUDIES</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_social">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_social">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social1"
                            value="identify animal sounds and sounds around us">
                        <label for="social1" class="topic-text">Identify animal sounds and sounds around us</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social2"
                            value="identify animals that produce milk">
                        <label for="social2" class="topic-text">Identify animals that produce milk</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social3" value="good habits we do every day">
                        <label for="social3" class="topic-text">Good habits we do every day</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social4" value="our personal hygiene">
                        <label for="social4" class="topic-text">Our personal hygiene</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social5" value="good and bad gestures">
                        <label for="social5" class="topic-text">Good and bad gestures</label>
                    </div>
                </div>
            </div>

            <!-- SCIENCE -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('science')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_science" value="Science"
                            onchange="handleSubjectCheck('science')">
                        <label for="subject_science">SCIENCE</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_science">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_science">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science1" value="Tissue Magic experiment">
                        <label for="science1" class="topic-text">Tissue Magic</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science2" value="Lava lamp experiment">
                        <label for="science2" class="topic-text">Lava lamp</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science3" value="Magnet experiment">
                        <label for="science3" class="topic-text">Magnet</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science4" value="Lemon volcano experiment">
                        <label for="science4" class="topic-text">Lemon volcano</label>
                    </div>
                </div>
            </div>

            <!-- COOKING -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('cooking')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_cooking" value="Cooking"
                            onchange="handleSubjectCheck('cooking')">
                        <label for="subject_cooking">COOKING</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_cooking">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_cooking">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="cooking1" value="Look chop cooking activity">
                        <label for="cooking1" class="topic-text">Look chop</label>
                    </div>
                </div>
            </div>

            <!-- CONVERSATION 1 -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('conv1')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_conv1" value="Conversation 1"
                            onchange="handleSubjectCheck('conv1')">
                        <label for="subject_conv1">CONVERSATION 1</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_conv1">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_conv1">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_1" value="what pet do you have">
                        <label for="conv1_1" class="topic-text">What pet do you have? (I have a dog/cat)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_2" value="how do you feel">
                        <label for="conv1_2" class="topic-text">How do you feel? (I feel happy/sad)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_3"
                            value="what would you like for lunch">
                        <label for="conv1_3" class="topic-text">What would you like for lunch? (I would like...)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_4" value="what do you want to be">
                        <label for="conv1_4" class="topic-text">What do you want to be? (I want to be a
                            doctor/teacher)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_5" value="where would you like to go">
                        <label for="conv1_5" class="topic-text">Where would you like to go? (I like to go to the
                            zoo/park)</label>
                    </div>
                </div>
            </div>

            <!-- CONVERSATION 2 -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('conv2')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_conv2" value="Conversation 2"
                            onchange="handleSubjectCheck('conv2')">
                        <label for="subject_conv2">CONVERSATION 2</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_conv2">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_conv2">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv2_1" value="what do you like to drink">
                        <label for="conv2_1" class="topic-text">What do you like to drink? (I like to drink
                            milk)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv2_2" value="where are you going">
                        <label for="conv2_2" class="topic-text">Where are you going? (I'm going to the hospital)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv2_3" value="how do you go to school">
                        <label for="conv2_3" class="topic-text">How do you go to school? (I go to school by car)</label>
                    </div>
                </div>
            </div>

            <!-- ARTS -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('arts')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_arts" value="Arts"
                            onchange="handleSubjectCheck('arts')">
                        <label for="subject_arts">ARTS</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_arts">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_arts">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="arts1" value="finger painting">
                        <label for="arts1" class="topic-text">Finger painting</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="arts2" value="ladybug craft">
                        <label for="arts2" class="topic-text">Ladybug</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="arts3" value="play dough activities">
                        <label for="arts3" class="topic-text">Play Dough</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="arts4" value="sponge painting">
                        <label for="arts4" class="topic-text">Sponge painting</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="arts5" value="origami fox">
                        <label for="arts5" class="topic-text">Origami Fox</label>
                    </div>
                </div>
            </div>

            <!-- PHYSICAL EDUCATION -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('pe')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_pe" value="Physical Education"
                            onchange="handleSubjectCheck('pe')">
                        <label for="subject_pe">PHYSICAL EDUCATION</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_pe">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_pe">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe1" value="playing football">
                        <label for="pe1" class="topic-text">Playing football</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe2" value="balance the ball">
                        <label for="pe2" class="topic-text">Balance the ball</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe3" value="put ball in the ring">
                        <label for="pe3" class="topic-text">Put ball in the ring</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe4" value="balance and jump in circle">
                        <label for="pe4" class="topic-text">Balance and jump in circle</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe5" value="zigzag and going under arches">
                        <label for="pe5" class="topic-text">Zigzag and going under arches</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe6" value="hurdle jumping">
                        <label for="pe6" class="topic-text">Hurdle jumping</label>
                    </div>
                </div>
            </div>

            <!-- PUPPET SHOW -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('puppet')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_puppet" value="Puppet Show"
                            onchange="handleSubjectCheck('puppet')">
                        <label for="subject_puppet">PUPPET SHOW</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_puppet">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_puppet">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="puppet1"
                            value="Noond doesn't eat her vegetables">
                        <label for="puppet1" class="topic-text">Noond doesn't eat her vegetables</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="puppet2"
                            value="the tale of the panicked rabbit">
                        <label for="puppet2" class="topic-text">The tale of the panicked rabbit</label>
                    </div>
                </div>
            </div>

            <!-- SUPER SAFARI -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('safari')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_safari" value="Super Safari"
                            onchange="handleSubjectCheck('safari')">
                        <label for="subject_safari">SUPER SAFARI</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_safari">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_safari">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari1" value="listen and colour">
                        <label for="safari1" class="topic-text">Listen and colour</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari2" value="say the numbers">
                        <label for="safari2" class="topic-text">Say the numbers</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari3" value="look and circle">
                        <label for="safari3" class="topic-text">Look and circle</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari4" value="say the sentence">
                        <label for="safari4" class="topic-text">Say the sentence</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari5" value="colour the correct circle">
                        <label for="safari5" class="topic-text">Colour the correct circle</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari6" value="complete the face">
                        <label for="safari6" class="topic-text">Complete the face</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari7" value="color different pictures">
                        <label for="safari7" class="topic-text">Color different pictures</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari8" value="join the dots">
                        <label for="safari8" class="topic-text">Join the dots</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari9" value="my pets - say the pets">
                        <label for="safari9" class="topic-text">My pets - Say the pets</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari10" value="look and match">
                        <label for="safari10" class="topic-text">Look and match</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari11" value="food - say the food">
                        <label for="safari11" class="topic-text">Food - Say the food</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari12" value="draw something">
                        <label for="safari12" class="topic-text">Draw something</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari13" value="maze activity">
                        <label for="safari13" class="topic-text">Maze activity</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari14"
                            value="Super Safari arts and crafts">
                        <label for="safari14" class="topic-text">Super Safari Arts and Crafts</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari15" value="let's make a train">
                        <label for="safari15" class="topic-text">Let's make a train</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari16" value="hanging letters S/N/I">
                        <label for="safari16" class="topic-text">Hanging letters S/N/I</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari17" value="make a handprint bird">
                        <label for="safari17" class="topic-text">Make a handprint bird</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari18" value="make a pasta fish">
                        <label for="safari18" class="topic-text">Make a pasta fish</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="safari19" value="animals mask">
                        <label for="safari19" class="topic-text">Animals Mask</label>
                    </div>
                </div>
            </div>

            <!-- STORY TIME -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('story')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_story" value="Story Time"
                            onchange="handleSubjectCheck('story')">
                        <label for="subject_story">STORY TIME</label>
                        <span class="dropdown-hint">Click to drop down</span>
                        <span class="dropdown-arrow" id="arrow_story">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_story">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="story1" value="Harry frog">
                        <label for="story1" class="topic-text">Harry frog</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="story2" value="Bird story">
                        <label for="story2" class="topic-text">Bird</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="story3" value="the lovely animals">
                        <label for="story3" class="topic-text">The lovely animals</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="story4" value="the ox and the frog">
                        <label for="story4" class="topic-text">The ox and the frog</label>
                    </div>
                </div>
            </div>
        </form>

        <div class="comments-section" id="commentsSection">
            <h2 class="color-primary text-center">Generate Report Comments</h2>
            <p class="text-center color-secondary margin-bottom-30">
                Click the button below to generate personalized comments based on your selections.
            </p>

            <div class="final-actions">
                <button type="button" class="button button-success" id="generateBtn"
                    onclick="ensureCommentGeneration()">
                    Generate Comments
                </button>
            </div>

            <div id="generatedComments" class="display-none">
                <h3 class="color-primary margin-top-30">Choose your preferred comment:</h3>
                <div class="comment-option" id="comment1" onclick="selectComment(1)">
                    <h4>üë®‚Äçüè´ Male Teacher Style <span id="wordCount1"
                            class="color-secondary font-weight-normal font-size-14"></span></h4>
                    <div id="commentText1" class="comment-box">Comments will appear here after generation...</div>
                </div>

                <div class="comment-option" id="comment2" onclick="selectComment(2)">
                    <h4>üë©‚Äçüè´ Female Teacher Style <span id="wordCount2"
                            class="color-secondary font-weight-normal font-size-14"></span></h4>
                    <div id="commentText2" class="comment-box">Comments will appear here after generation...</div>
                </div>

                <div class="final-actions">
                    <button type="button" class="button" onclick="copySelectedComment()">üìã Copy Selected
                        Comment</button>
                    <button type="button" class="button" onclick="ensureCommentGeneration()">üîÑ Generate New
                        Comments</button>
                    <button type="button" class="button button-success" onclick="exportReport()">üìÑ Export
                        Report</button>
                    <button type="button" class="button" onclick="startOver()">üîÑ Start Over</button>
                </div>
            </div>
        </div> <!-- .comments-section -->

    </div> <!-- .container -->

    <!-- Load curriculum dynamically based on grade and month -->
    <script id="dynamic-curriculum-loader">
        document.addEventListener('DOMContentLoaded', async function () {
            try {
                // Get grade and month from session
                const params = new URLSearchParams(window.location.search);
                let grade = params.get('grade');
                let month = params.get('month');
                // Fallback to localStorage.studentData if missing
                if (!grade || !month) {
                    try {
                        const saved = localStorage.getItem('studentData');
                        if (saved) {
                            const data = JSON.parse(saved);
                            grade = grade || data.grade || 'K1';
                            month = month || data.month || 'August';
                        }
                    } catch (e) {
                        grade = grade || 'K1';
                        month = month || 'August';
                    }
                }

                console.log(`üìö Selected curriculum: ${grade} - ${month}`);

                // Load curriculum data
                if (window.curriculumLoader) {
                    const curriculum = await window.curriculumLoader.load(grade, month);
                    console.log('‚úÖ Curriculum data loaded:', curriculum);

                    // Generate subjects HTML dynamically
                    const subjectsForm = document.getElementById('subjectsForm');
                    if (subjectsForm && curriculum.subjects) {
                        // CLEAR existing hardcoded HTML first
                        subjectsForm.innerHTML = '';

                        let html = '';

                        curriculum.subjects.forEach(subject => {
                            html += `
                            <!-- ${subject.name.toUpperCase()} -->
                            <div class="subject-section">
                                <div class="subject-header" onclick="toggleSubject('${subject.id}')">
                                    <div class="subject-title">
                                        <input type="checkbox" class="subject-checkbox" id="subject_${subject.id}" value="${subject.name}"
                                            onchange="handleSubjectCheck('${subject.id}')">
                                        <label for="subject_${subject.id}">${subject.name.toUpperCase()}</label>
                                        <span class="dropdown-hint">Click to drop down</span>
                                        <span class="dropdown-arrow" id="arrow_${subject.id}">‚ñº</span>
                                    </div>
                                </div>
                                <div class="subject-content" id="content_${subject.id}">`;

                            subject.topics.forEach((topic, index) => {
                                const topicId = `${subject.id}${index + 1}`;
                                html += `
                                    <div class="topic-item">
                                        <input type="checkbox" class="topic-checkbox" id="${topicId}"
                                            value="${topic.name.toLowerCase()}" 
                                            onchange="saveSelections(); debouncedUpdateSelectionCount();">
                                        <label for="${topicId}" class="topic-text">${topic.name}</label>
                                    </div>`;
                            });

                            html += `
                                </div>
                            </div>`;
                        });

                        // Replace hardcoded HTML with dynamic content
                        subjectsForm.innerHTML = html;
                        console.log('‚úÖ Dynamically generated', curriculum.subjects.length, 'subjects');
                    }
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Curriculum loading failed, keeping hardcoded subjects:', error.message);
                // Fallback to hardcoded K1 August subjects (current implementation)
            }
        });
    </script>

    <script>
        let selectedTopics = [];
        let selectedComment = null;

        // Define functions immediately to prevent "not defined" errors
        console.log('Subjects.html JavaScript loaded successfully');

        // Immediate fallback for toggleSubject function
        window.toggleSubject = function (subjectId) {
            console.log('üîÑ FALLBACK toggleSubject called for:', subjectId);

            const content = document.getElementById('content_' + subjectId);
            const arrow = document.getElementById('arrow_' + subjectId);

            console.log('FALLBACK - Content element:', content);
            console.log('FALLBACK - Arrow element:', arrow);

            if (!content || !arrow) {
                console.error('‚ùå FALLBACK - Subject elements not found for:', subjectId);
                return;
            }

            const isActive = content.classList.contains('active');
            console.log('FALLBACK - Current active state:', isActive);

            if (isActive) {
                content.classList.remove('active');
                arrow.classList.remove('rotated');
                console.log('‚úÖ FALLBACK - Collapsed subject:', subjectId);
            } else {
                content.classList.add('active');
                arrow.classList.add('rotated');
                console.log('‚úÖ FALLBACK - Expanded subject:', subjectId);
            }
        };

        // Immediate fallback for handleSubjectCheck function
        window.handleSubjectCheck = function (subjectId) {
            console.log('üîÑ FALLBACK handleSubjectCheck called for:', subjectId);

            const checkbox = document.getElementById('subject_' + subjectId);
            const content = document.getElementById('content_' + subjectId);

            if (!checkbox || !content) {
                console.error('‚ùå FALLBACK - Subject checkbox or content not found for:', subjectId);
                return;
            }

            const topicCheckboxes = content.querySelectorAll('.topic-checkbox');

            if (checkbox.checked) {
                // Check all topics in this subject
                topicCheckboxes.forEach(cb => cb.checked = true);
            } else {
                // Uncheck all topics in this subject
                topicCheckboxes.forEach(cb => cb.checked = false);
            }

            // Update selection count
            if (typeof updateSelectionCount === 'function') {
                updateSelectionCount();
            }
        };

        // Functions are now loaded from missing-functions.js

        // On load, log what student data we can see and try a gentle restore
        document.addEventListener('DOMContentLoaded', () => {
            const safeParse = (v) => { try { return JSON.parse(v || '{}'); } catch { return {}; } };

            // ‚ö° PERFORMANCE OPTIMIZATION: Try namespace pattern first, fallback to legacy
            let sd = studentStore.get('data');
            if (!sd || !sd.studentName || !sd.gender) {
                // Fallback to legacy localStorage key
                sd = safeParse(localStorage.getItem('studentData'));
            }

            if (!sd || !sd.studentName || !sd.gender) {
                const ss = safeParse(sessionStorage.getItem('studentData'));
                if (ss.studentName && ss.gender) {
                    console.warn('‚ÑπÔ∏è Subjects: restoring studentData from sessionStorage on load');
                    // Use transact pattern for atomic update
                    try {
                        studentStore.set('data', ss);
                        localStorage.setItem('studentData', JSON.stringify(ss)); // Legacy compatibility
                    } catch { }
                    sd = ss;
                }
            }
            console.log('üëÄ Subjects page sees studentData:', sd);
        });

        function saveSelections() {
            const selectedTopics = [];
            const selectedSubjects = [];

            // ‚ö° PERFORMANCE OPTIMIZATION: Cache DOM query results (called once instead of twice)
            const checkedTopicBoxes = document.querySelectorAll('.topic-checkbox:checked');
            const checkedSubjectBoxes = document.querySelectorAll('.subject-checkbox:checked');

            checkedTopicBoxes.forEach(checkbox => {
                selectedTopics.push(checkbox.value);
            });

            checkedSubjectBoxes.forEach(checkbox => {
                selectedSubjects.push(checkbox.value);
            });

            // ‚ö° PERFORMANCE OPTIMIZATION: Batch localStorage operations (1 operation instead of 2)
            // Also maintain backward compatibility with old keys
            selectionStore.setAll({
                'subjects': selectedTopics,
                'subjectTitles': selectedSubjects,
                'timestamp': Date.now()
            });

            // Keep legacy keys for backward compatibility
            localStorage.setItem('selectedSubjects', JSON.stringify(selectedTopics));
            localStorage.setItem('selectedSubjectTitles', JSON.stringify(selectedSubjects));

            updateSelections();
        }

        function updateSelections() {
            updateSelectionCount();
        }

        // selectAll and clearAll functions are now loaded from missing-functions.js
        // refreshReport function is now loaded from missing-functions.js

        // startOver function is now loaded from missing-functions.js

        function updateSelectionCount() {
            // ‚ö° PERFORMANCE OPTIMIZATION: Cache query result
            const checkedTopics = document.querySelectorAll('.topic-checkbox:checked');
            const count = checkedTopics.length;
            const countElement = document.getElementById('selectionCount');
            if (countElement) {
                countElement.textContent = count;
            }
        }

        function loadSelections() {
            // ‚ö° PERFORMANCE OPTIMIZATION: Try namespace pattern first, fallback to legacy
            let savedTopics = selectionStore.get('subjects');
            let savedSubjects = selectionStore.get('subjectTitles');

            // Fallback to legacy keys for backward compatibility
            if (!savedTopics) {
                const legacyData = localStorage.getItem('selectedSubjects');
                savedTopics = legacyData ? JSON.parse(legacyData) : null;
            }
            if (!savedSubjects) {
                const legacyData = localStorage.getItem('selectedSubjectTitles');
                savedSubjects = legacyData ? JSON.parse(legacyData) : null;
            }

            // ‚ö° PERFORMANCE OPTIMIZATION: Cache all DOM queries once
            const allSubjectContents = document.querySelectorAll('.subject-content');
            const allDropdownArrows = document.querySelectorAll('.dropdown-arrow');
            const allTopicCheckboxes = document.querySelectorAll('.topic-checkbox');
            const allSubjectCheckboxes = document.querySelectorAll('.subject-checkbox');

            // First, ensure all dropdowns are closed
            allSubjectContents.forEach(content => {
                content.classList.remove('active');
            });
            allDropdownArrows.forEach(arrow => {
                arrow.classList.remove('rotated');
            });

            if (savedTopics) {
                const selectedValues = JSON.parse(savedTopics);
                allTopicCheckboxes.forEach(checkbox => {
                    if (selectedValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }

            if (savedSubjects) {
                const selectedSubjects = JSON.parse(savedSubjects);
                allSubjectCheckboxes.forEach(checkbox => {
                    if (selectedSubjects.includes(checkbox.value)) {
                        checkbox.checked = true;
                        const subjectId = checkbox.id.replace('subject_', '');
                        handleSubjectCheck(subjectId);
                    }
                });
            }

            updateSelectionCount();
        }

        // updateSelectionCount function moved to top of script

        // duplicate function removed

        // selectAll function moved to top of script

        // ‚ö° PERFORMANCE OPTIMIZATION: Storage Namespace Pattern (Week 2)
        const TeachersPetStorage = {
            namespace: (prefix) => ({
                get: (key) => {
                    try {
                        const val = localStorage.getItem(`${prefix}.${key}`);
                        return val ? JSON.parse(val) : null;
                    } catch { return null; }
                },
                set: (key, value) => {
                    try {
                        localStorage.setItem(`${prefix}.${key}`, JSON.stringify(value));
                    } catch (e) { console.error('Storage set failed:', e); }
                },
                setAll: (obj) => {
                    Object.entries(obj).forEach(([k, v]) => {
                        try {
                            localStorage.setItem(`${prefix}.${k}`, JSON.stringify(v));
                        } catch (e) { console.error(`Storage setAll failed for ${k}:`, e); }
                    });
                },
                getAll: (keys) => {
                    const result = {};
                    keys.forEach(k => {
                        try {
                            const val = localStorage.getItem(`${prefix}.${k}`);
                            result[k] = val ? JSON.parse(val) : null;
                        } catch { result[k] = null; }
                    });
                    return result;
                },
                transact: (fn) => {
                    try {
                        fn();
                    } catch (e) { console.error('Transaction failed:', e); }
                }
            })
        };

        // Initialize storage namespaces
        const studentStore = TeachersPetStorage.namespace('student');
        const selectionStore = TeachersPetStorage.namespace('selection');

        // clearAll function moved to top of script

        // saveSelections function moved to top of script
        // loadSelections function moved to top of script

        // ensureCommentGeneration function is now loaded from missing-functions.js

        // selectComment function is now loaded from missing-functions.js

        // copySelectedComment function is now loaded from missing-functions.js

        // goBack function is now loaded from missing-functions.js

        // ‚ùå REMOVED: Legacy generateComment() function - ALL comment generation now in enhanced-comment-engine.js
        // This function was creating fake subject data (I.Q appearing when not selected)

        function generateComment_DISABLED_DO_NOT_USE(studentData, selectedTopics, selectedSubjects, variant) {
            console.error('‚ùå CRITICAL: Legacy generateComment() called - this should NEVER happen!');
            console.error('All comment generation must use enhanced-comment-engine.js');
            return 'ERROR: Legacy comment generator called. Please refresh and try again.';

            /* ORIGINAL CODE DISABLED - DO NOT RE-ENABLE
            const name = studentData.studentName || 'The student';
            const gender = studentData.gender || 'they';

            // Pronoun setup
            const pronouns = {
                he: { subject: 'He', object: 'him', possessive: 'his', verb: 'has', isAre: 'is' },
                she: { subject: 'She', object: 'her', possessive: 'her', verb: 'has', isAre: 'is' },
                they: { subject: 'They', object: 'them', possessive: 'their', verb: 'have', isAre: 'are' }
            };
            const p = pronouns[gender] || pronouns.they;

            const overall = parseInt(studentData.overallAttributes || 5);
            const strengths = studentData.strengths || '';

            const subjectData = selectedSubjects || [];

            function capitalizeSubjects(subjectList) {
                return subjectList.map(subject => {
                    const lower = subject.toLowerCase();
                    const specialCases = {
                        'english': 'English',
                        'mathematics': 'Mathematics',
                        'science': 'Science',
                        'social studies': 'Social Studies',
                        'i.q': 'I.Q',
                        'physical education': 'Physical Education',
                        'cooking': 'Cooking',
                        'conversation 1': 'Conversation 1',
                        'conversation 2': 'Conversation 2',
                        'arts': 'Arts',
                        'puppet show': 'Puppet Show',
                        'super safari': 'Super Safari',
                        'story time': 'Story Time'
                    };
                    if (specialCases[lower]) return specialCases[lower];
                    if (lower.includes('conversation')) return subject.charAt(0).toUpperCase() + subject.slice(1);
                    return subject.charAt(0).toUpperCase() + subject.slice(1);
                });
            }

            const performanceMap = {
                10: { level: 'exceptional' }, 9: { level: 'excellent' }, 8: { level: 'very strong' },
                7: { level: 'strong' }, 6: { level: 'good' }, 5: { level: 'satisfactory' },
                4: { level: 'developing' }, 3: { level: 'basic' }, 2: { level: 'beginning' }, 1: { level: 'emerging' }
            };

            const perf = performanceMap[overall] || performanceMap[5];
            const isMaleTeacher = variant === 1;

            // Helper to join lists naturally
            function naturalJoin(arr) {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                if (arr.length === 2) return arr.join(' and ');
                return arr.slice(0, -1).join(', ') + ', and ' + arr.slice(-1);
            }

            // Generate concise comment with maximum 80 words
            let comment;

            if (isMaleTeacher) {
                comment = name + ' demonstrated ' + perf.level + ' performance this term across multiple learning areas.';

                if (strengths.trim()) {
                    const strengthList = strengths.split(',').map(s => s.trim().toLowerCase()).filter(Boolean).slice(0, 2);
                    if (strengthList.length > 0) {
                        comment += ' ' + p.subject + ' shows strong capabilities in ' + naturalJoin(strengthList) + '.';
                    }
                }

                if (subjectData.length > 0) {
                    const capitalizedSubjects = capitalizeSubjects(subjectData.slice(0, 2));
                    comment += ' In ' + naturalJoin(capitalizedSubjects) + ', ' + name + ' shows consistent growth.';
                }

                comment += ' ' + name + ' shows excellent potential for continued learning success.';
            } else {
                comment = 'It has been a pleasure watching ' + name + ' grow this term.';

                if (strengths.trim()) {
                    const strengthList = strengths.split(',').map(s => s.trim().toLowerCase()).filter(Boolean).slice(0, 2);
                    if (strengthList.length > 0) {
                        comment += ' ' + p.possessive + ' talent for ' + naturalJoin(strengthList) + ' truly shines.';
                    }
                }

                if (subjectData.length > 0) {
                    const capitalizedSubjects = capitalizeSubjects(subjectData.slice(0, 2));
                    comment += ' ' + p.subject + ' has shown wonderful progress in ' + naturalJoin(capitalizedSubjects) + '.';
                }

                comment += ' ' + name + ' brings joy to learning and shows wonderful potential for future success.';
            }

            // Ensure proper ending punctuation
            if (!/[.!?]$/.test(comment)) {
                comment = comment.replace(/[,;:]\s*$/, '') + '.';
            }

            return comment;
            END OF DISABLED CODE */
        }

        // generateComments function is now handled by optimized-comment-generator.js

        // toggleSubject and handleSubjectCheck functions moved to top of script

        // Load saved selections on page load
        window.addEventListener('load', loadSelections);

        // startOver function moved to top of script

        // selectComment function is now loaded from missing-functions.js

        // copySelectedComment function is now loaded from missing-functions.js

        // All functions are now loaded from missing-functions.js

        // Initialize page when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Subjects page JavaScript initialized');
        });
    </script>
    <!-- Performance & UX Enhancement Scripts -->
    <script src="assets/js/utils/performance-optimizer.js"></script>
    <script src="assets/js/utils/ui-enhancements.js"></script>
    <script src="assets/js/synonym-manager.js"></script>
    <script src="localstorage-monitor.js"></script>
    <script src="assets/js/data/engine-data.js"></script>
    <script src="assets/js/comment-engine.js"></script>
    <!-- Engine Modules (Refactored) -->
    <script src="assets/js/engine/utils.js"></script>
    <script src="assets/js/engine/processor.js"></script>
    <script src="assets/js/engine/templates.js"></script>
    <script src="assets/js/engine/core.js"></script>
    <script src="optimized-comment-generator.js"></script>
    <script src="assets/js/ui/shared-ui.js"></script>
    <script src="assets/js/ui/subjects-ui.js"></script>
</body>

</html>