<!DOCTYPE html>
<html lang="en" spellcheck="false">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Select subjects and topics for comprehensive report generation">
    <title>üìö Subject Selection - Teachers Pet</title>
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/css/components.css" as="style">
    <link rel="preload" href="assets/js/app.js" as="script">
    <link rel="preload" href="assets/js/comment-engine.js" as="script">
    
    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
</head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                url('https://images.unsplash.com/photo-1502134249126-9f3755a50d78?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover no-repeat fixed,
                radial-gradient(ellipse at center, rgba(30, 39, 70, 0.8) 0%, rgba(15, 15, 35, 0.9) 50%, rgba(0, 0, 0, 0.95) 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Space stars animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.6), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.5), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.4), transparent),
                radial-gradient(2px 2px at 160px 30px, rgba(255, 255, 255, 0.7), transparent);
            background-repeat: repeat;
            background-size: 200px 200px;
            animation: twinkle 20s linear infinite;
            pointer-events: none;
            z-index: 1;
            will-change: transform, opacity;
        }
        
        @keyframes twinkle {
            0% { transform: translate3d(0px, 0px, 0) rotate(0deg); opacity: 0.8; }
            50% { opacity: 1; }
            100% { transform: translate3d(100px, -200px, 0) rotate(360deg); opacity: 0.8; }
        }
        
        .container {
            background: rgba(255, 255, 255, 0.3);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 50px rgba(255, 255, 255, 0.1);
        }
        
        .refresh-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #27ae60;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .refresh-button:hover {
            background-color: #229954;
        }
        
        h1 {
            color: white;
            font-size: 2.2em;
            margin-bottom: 25px;
            font-weight: 600;
            text-align: center;
            font-family: 'Segoe UI', sans-serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subject-section {
            margin-bottom: 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .subject-header {
            padding: 15px 20px;
            cursor: pointer;
            background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .subject-header:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .subject-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .topic-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            gap: 10px;
        }
        
        .topic-text {
            flex: 1;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            font-size: 14px;
        }
        
        .dropdown-arrow {
            transition: transform 0.3s ease;
            color: white;
            margin-left: auto;
        }
        
        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }
        
        .button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Segoe UI', sans-serif;
            margin: 8px 4px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .button-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
        }
        
        .button-success:hover {
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .selection-summary {
            background: #f1f8ff;
            border: 1px solid #3498db;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
            color: #2c3e50;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .bulk-actions {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e0e6ed;
            border-radius: 8px;
            text-align: center;
        }
        
        .comment-option {
            margin: 15px 0;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .comment-option:hover {
            border-color: #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
        }
        
        .comment-option.selected {
            border-color: #27ae60;
            background: #f1f8ff;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
        }
        
        .navigation {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            border-top: 2px solid #e0e6ed;
        }
        
        .final-actions {
            margin-top: 20px;
            text-align: center;
            padding: 15px;
            border-top: 1px solid #e0e6ed;
        }
        
        .comments-section {
            margin-top: 25px;
            border-top: 2px solid #e0e6ed;
            padding-top: 25px;
        }
        
        .comment-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            min-height: 80px;
            border: 1px solid #e0e6ed;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .subject-content {
            display: none !important;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-top: 1px solid rgba(255,255,255,0.1);
            opacity: 0;
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
        }
        
        .subject-content.active {
            display: block !important;
            opacity: 1;
            max-height: 1000px;
        }
        
        /* Additional debugging styles */
        .subject-content.active .topic-item {
            animation: fadeInUp 0.3s ease forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .subject-header {
                padding: 12px 15px;
            }
            
            .subject-title {
                font-size: 16px;
            }
            
            .topic-text {
                font-size: 13px;
            }
            
            .button {
                padding: 10px 20px;
                font-size: 13px;
                margin: 6px 3px;
            }
            
            .comment-option {
                padding: 12px;
                margin: 10px 0;
            }
            
            .comment-box {
                min-height: 60px;
                font-size: 13px;
            }
        }
    </style>
    <link rel="stylesheet" href="styles/inline-fixes.css">
</head>
<body>
    <div class="container">
        <button type="button" class="refresh-button" onclick="refreshReport()">üîÑ Refresh Report</button>
        <h1>Subject Selection</h1>
        <p class="text-center color-secondary margin-bottom-25 font-family-segoe">
            Select subjects and rate student performance (0-5 scale, 5 being excellent).
        </p>
        
        <div class="bulk-actions">
            <button type="button" class="button" onclick="selectAll()">Select All</button>
            <button type="button" class="button" onclick="clearAll()">Clear All</button>
            <button type="button" class="button" onclick="debugToggleSubjects()">üîß Debug Toggle</button>
            <button type="button" class="button" onclick="expandAllSubjects()">üìñ Expand All</button>
            <button type="button" class="button" onclick="collapseAllSubjects()">üìò Collapse All</button>
        </div>

        <div class="selection-summary">
            <strong>Selected Topics: </strong><span id="selectionCount">0</span>
        </div>

        <form id="subjectsForm">
            <!-- ENGLISH -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('english')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_english" value="English" onchange="handleSubjectCheck('english')">
                        <label for="subject_english">ENGLISH</label>
                        <span class="dropdown-arrow" id="arrow_english">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_english">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english1" value="matching letters to pictures">
                        <label for="english1" class="topic-text">Matching letters to pictures</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english2" value="tracing and coloring letters">
                        <label for="english2" class="topic-text">Tracing and coloring letters</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english3" value="matching identical letters">
                        <label for="english3" class="topic-text">Matching identical letters</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english4" value="identifying beginning letter sounds">
                        <label for="english4" class="topic-text">Identifying beginning letter sounds</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english5" value="singing the alphabet song with actions">
                        <label for="english5" class="topic-text">Singing the alphabet song with actions</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="english6" value="writing uppercase and lowercase letters">
                        <label for="english6" class="topic-text">Writing uppercase and lowercase letters</label>
                    </div>
                </div>
            </div>            <!-- PHONICS -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('phonics')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_phonics" value="Phonics" onchange="handleSubjectCheck('phonics')">
                        <label for="subject_phonics">PHONICS</label>
                        <span class="dropdown-arrow" id="arrow_phonics">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_phonics">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics1" value="recognizing letters A-E">
                        <label for="phonics1" class="topic-text">Recognizing letters A-E</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics2" value="learning 'C' vocabulary (e.g., Cat, Cut)">
                        <label for="phonics2" class="topic-text">Learning 'C' vocabulary (e.g., Cat, Cut)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics3" value="learning 'E' vocabulary (e.g., Elephant, Egg)">
                        <label for="phonics3" class="topic-text">Learning 'E' vocabulary (e.g., Elephant, Egg)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics4" value="identifying the beginning sounds of objects">
                        <label for="phonics4" class="topic-text">Identifying the beginning sounds of objects</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics5" value="blending simple CVC words">
                        <label for="phonics5" class="topic-text">Blending simple CVC words</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="phonics6" value="recognizing rhyming words">
                        <label for="phonics6" class="topic-text">Recognizing rhyming words</label>
                    </div>
                </div>
            </div>            <!-- MATHEMATICS -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('mathematics')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_mathematics" value="Mathematics" onchange="handleSubjectCheck('mathematics')">
                        <label for="subject_mathematics">MATHEMATICS</label>
                        <span class="dropdown-arrow" id="arrow_mathematics">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_mathematics">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math1" value="counting from 1 to 10">
                        <label for="math1" class="topic-text">Counting from 1 to 10</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math2" value="tracing numbers 1-3">
                        <label for="math2" class="topic-text">Tracing numbers 1-3</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math3" value="matching quantities to numbers">
                        <label for="math3" class="topic-text">Matching quantities to numbers</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math4" value="counting with fingers">
                        <label for="math4" class="topic-text">Counting with fingers</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math5" value="identifying basic shapes">
                        <label for="math5" class="topic-text">Identifying basic shapes</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="math6" value="sorting objects by shape">
                        <label for="math6" class="topic-text">Sorting objects by shape</label>
                    </div>
                </div>
            </div>            <!-- I.Q -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('iq')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_iq" value="I.Q" onchange="handleSubjectCheck('iq')">
                        <label for="subject_iq">I.Q</label>
                        <span class="dropdown-arrow" id="arrow_iq">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_iq">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq1" value="matching animals to their food">
                        <label for="iq1" class="topic-text">Matching animals to their food</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq2" value="recognizing shapes and colors">
                        <label for="iq2" class="topic-text">Recognizing shapes and colors</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq3" value="completing shape puzzles">
                        <label for="iq3" class="topic-text">Completing shape puzzles</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq4" value="playing memory games">
                        <label for="iq4" class="topic-text">Playing memory games</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq5" value="sorting objects by size">
                        <label for="iq5" class="topic-text">Sorting objects by size</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="iq6" value="recognizing and completing patterns">
                        <label for="iq6" class="topic-text">Recognizing and completing patterns</label>
                    </div>
                </div>
            </div>            <!-- SOCIAL STUDIES -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('social')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_social" value="Social Studies" onchange="handleSubjectCheck('social')">
                        <label for="subject_social">SOCIAL STUDIES</label>
                        <span class="dropdown-arrow" id="arrow_social">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_social">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social1" value="learning about farm animals">
                        <label for="social1" class="topic-text">Learning about farm animals</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social2" value="identifying animal sounds">
                        <label for="social2" class="topic-text">Identifying animal sounds</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social3" value="learning parts of the body">
                        <label for="social3" class="topic-text">Learning parts of the body (e.g., face)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social4" value="discussing community helpers">
                        <label for="social4" class="topic-text">Discussing community helpers and their roles</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social5" value="practicing good manners">
                        <label for="social5" class="topic-text">Practicing good manners at school</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="social6" value="talking about family members">
                        <label for="social6" class="topic-text">Talking about family members and relationships</label>
                    </div>
                </div>
            </div>            <!-- SCIENCE -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('science')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_science" value="Science" onchange="handleSubjectCheck('science')">
                        <label for="subject_science">SCIENCE</label>
                        <span class="dropdown-arrow" id="arrow_science">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_science">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science1" value="exploring buoyancy with floating/sinking eggs">
                        <label for="science1" class="topic-text">Exploring buoyancy with floating/sinking eggs</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science2" value="investigating buoyancy with different objects">
                        <label for="science2" class="topic-text">Investigating buoyancy with different objects</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science3" value="observing gas production in experiments">
                        <label for="science3" class="topic-text">Observing gas production (e.g., balloon blow-up)</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science4" value="learning about surface tension with milk and colors">
                        <label for="science4" class="topic-text">Learning about surface tension with milk and colors</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science5" value="exploring the five senses">
                        <label for="science5" class="topic-text">Exploring the five senses</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="science6" value="observing and recording the weather">
                        <label for="science6" class="topic-text">Observing and recording the weather</label>
                    </div>
                </div>
            </div>            <!-- CONVERSATION 1 -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('conv1')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_conv1" value="Conversation Skills" onchange="handleSubjectCheck('conv1')">
                        <label for="subject_conv1">CONVERSATION 1</label>
                        <span class="dropdown-arrow" id="arrow_conv1">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_conv1">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_1" value="answering 'How old are you?'">
                        <label for="conv1_1" class="topic-text">Answering "How old are you?"</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_2" value="talking about daily routines">
                        <label for="conv1_2" class="topic-text">Talking about daily routines</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_3" value="using greetings and introductions">
                        <label for="conv1_3" class="topic-text">Using greetings and introductions</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_4" value="answering simple yes/no questions">
                        <label for="conv1_4" class="topic-text">Answering simple yes/no questions</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_5" value="expressing likes and dislikes">
                        <label for="conv1_5" class="topic-text">Expressing likes and dislikes</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv1_6" value="using polite words (please, thank you)">
                        <label for="conv1_6" class="topic-text">Using polite words (please, thank you)</label>
                    </div>
                </div>
            </div>            <!-- CONVERSATION 3 -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('conv3')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_conv3" value="Vocabulary Development" onchange="handleSubjectCheck('conv3')">
                        <label for="subject_conv3">CONVERSATION 3</label>
                        <span class="dropdown-arrow" id="arrow_conv3">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_conv3">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_1" value="talking about favorite snacks">
                        <label for="conv3_1" class="topic-text">Talking about favorite snacks</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_2" value="naming different fruits">
                        <label for="conv3_2" class="topic-text">Naming different fruits</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_3" value="identifying various vegetables">
                        <label for="conv3_3" class="topic-text">Identifying various vegetables</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_4" value="learning animal vocabulary">
                        <label for="conv3_4" class="topic-text">Learning animal vocabulary</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_5" value="describing colors and sizes">
                        <label for="conv3_5" class="topic-text">Describing colors and sizes</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="conv3_6" value="discussing favorite activities">
                        <label for="conv3_6" class="topic-text">Discussing favorite activities</label>
                    </div>
                </div>
            </div>            <!-- PHYSICAL EDUCATION -->
            <div class="subject-section">
                <div class="subject-header" onclick="toggleSubject('pe')">
                    <div class="subject-title">
                        <input type="checkbox" class="subject-checkbox" id="subject_pe" value="Physical Education" onchange="handleSubjectCheck('pe')">
                        <label for="subject_pe">PHYSICAL EDUCATION</label>
                        <span class="dropdown-arrow" id="arrow_pe">‚ñº</span>
                    </div>
                </div>
                <div class="subject-content" id="content_pe">
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe1" value="passing a ball with peers">
                        <label for="pe1" class="topic-text">Passing a ball with peers</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe2" value="dropping and catching a ball">
                        <label for="pe2" class="topic-text">Dropping and catching a ball</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe3" value="participating in racing games">
                        <label for="pe3" class="topic-text">Participating in racing games</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe4" value="kicking a football">
                        <label for="pe4" class="topic-text">Kicking a football</label>
                    </div>
                    <div class="topic-item">
                        <input type="checkbox" class="topic-checkbox" id="pe5" value="practicing balance and coordination">
                        <label for="pe5" class="topic-text">Practicing balance and coordination</label>
                    </div>
                </div>
            </div>        </form>

        <div class="comments-section" id="commentsSection">
            <h2 class="color-primary text-center">Generate Report Comments</h2>
            <p class="text-center color-secondary margin-bottom-30">
                Click the button below to generate personalized comments based on your selections.
            </p>
            
            <div class="final-actions">
                <button type="button" class="button button-success" id="generateBtn" onclick="ensureCommentGeneration()">
                    Generate Comments
                </button>
            </div>

            <div id="generatedComments" class="display-none">
                <h3 class="color-primary margin-top-30">Choose your preferred comment:</h3>
                  <div class="comment-option" id="comment1" onclick="selectComment(1)">
                    <h4>üë®‚Äçüè´ Male Teacher Style <span id="wordCount1" class="color-secondary font-weight-normal font-size-14"></span></h4>
                    <div id="commentText1" class="comment-box">Comments will appear here after generation...</div>
                </div>
                
                <div class="comment-option" id="comment2" onclick="selectComment(2)">
                    <h4>üë©‚Äçüè´ Female Teacher Style <span id="wordCount2" class="color-secondary font-weight-normal font-size-14"></span></h4>
                    <div id="commentText2" class="comment-box">Comments will appear here after generation...</div>
                </div>

                <div class="final-actions">
                    <button type="button" class="button" onclick="copySelectedComment()">üìã Copy Selected Comment</button>
                    <button type="button" class="button" onclick="ensureCommentGeneration()">üîÑ Generate New Comments</button>
                    <button type="button" class="button button-success" onclick="exportReport()">üìÑ Export Report</button>
                    <button type="button" class="button" onclick="startOver()">üîÑ Start Over</button>
                </div>
            </div>
        </div> <!-- .comments-section -->

        <!-- back-button navigation -->
        <div class="navigation">
            <button type="button" class="button" onclick="goBack()">‚Üê Back to Student Info</button>
        </div>

    </div> <!-- .container -->

    <script>
        let selectedTopics = [];
        let selectedComment = null;

        // Define functions immediately to prevent "not defined" errors
        console.log('Subjects.html JavaScript loaded successfully');
        
        // Immediate fallback for toggleSubject function
        window.toggleSubject = function(subjectId) {
            console.log('üîÑ FALLBACK toggleSubject called for:', subjectId);
            
            const content = document.getElementById('content_' + subjectId);
            const arrow = document.getElementById('arrow_' + subjectId);
            
            console.log('FALLBACK - Content element:', content);
            console.log('FALLBACK - Arrow element:', arrow);
            
            if (!content || !arrow) {
                console.error('‚ùå FALLBACK - Subject elements not found for:', subjectId);
                return;
            }
            
            const isActive = content.classList.contains('active');
            console.log('FALLBACK - Current active state:', isActive);
            
            if (isActive) {
                content.classList.remove('active');
                arrow.classList.remove('rotated');
                console.log('‚úÖ FALLBACK - Collapsed subject:', subjectId);
            } else {
                content.classList.add('active');
                arrow.classList.add('rotated');
                console.log('‚úÖ FALLBACK - Expanded subject:', subjectId);
            }
        };
        
        // Immediate fallback for handleSubjectCheck function
        window.handleSubjectCheck = function(subjectId) {
            console.log('üîÑ FALLBACK handleSubjectCheck called for:', subjectId);
            
            const checkbox = document.getElementById('subject_' + subjectId);
            const content = document.getElementById('content_' + subjectId);
            
            if (!checkbox || !content) {
                console.error('‚ùå FALLBACK - Subject checkbox or content not found for:', subjectId);
                return;
            }
            
            const topicCheckboxes = content.querySelectorAll('.topic-checkbox');
            
            if (checkbox.checked) {
                // Check all topics in this subject
                topicCheckboxes.forEach(cb => cb.checked = true);
            } else {
                // Uncheck all topics in this subject
                topicCheckboxes.forEach(cb => cb.checked = false);
            }
            
            // Update selection count
            if (typeof updateSelectionCount === 'function') {
                updateSelectionCount();
            }
        };
        
        // Debug functions
        window.debugToggleSubjects = function() {
            console.log('üîß Debug: Testing toggle functionality');
            const subjects = ['english', 'phonics', 'mathematics', 'iq', 'social', 'science', 'conv1', 'conv3', 'pe'];
            subjects.forEach(subject => {
                const content = document.getElementById('content_' + subject);
                const arrow = document.getElementById('arrow_' + subject);
                console.log(`Subject ${subject}:`, {
                    content: content ? 'Found' : 'Missing',
                    arrow: arrow ? 'Found' : 'Missing',
                    active: content ? content.classList.contains('active') : 'N/A'
                });
            });
        };
        
        window.expandAllSubjects = function() {
            console.log('üìñ Expanding all subjects');
            const subjects = ['english', 'phonics', 'mathematics', 'iq', 'social', 'science', 'conv1', 'conv3', 'pe'];
            subjects.forEach(subject => {
                const content = document.getElementById('content_' + subject);
                const arrow = document.getElementById('arrow_' + subject);
                if (content && arrow) {
                    content.classList.add('active');
                    arrow.classList.add('rotated');
                }
            });
        };
        
        window.collapseAllSubjects = function() {
            console.log('üìò Collapsing all subjects');
            const subjects = ['english', 'phonics', 'mathematics', 'iq', 'social', 'science', 'conv1', 'conv3', 'pe'];
            subjects.forEach(subject => {
                const content = document.getElementById('content_' + subject);
                const arrow = document.getElementById('arrow_' + subject);
                if (content && arrow) {
                    content.classList.remove('active');
                    arrow.classList.remove('rotated');
                }
            });
        };
        
        // Functions are now loaded from missing-functions.js

        // On load, log what student data we can see and try a gentle restore
        document.addEventListener('DOMContentLoaded', () => {
            const safeParse = (v) => { try { return JSON.parse(v||'{}'); } catch { return {}; } };
            let sd = safeParse(localStorage.getItem('studentData'));
            if (!sd.studentName || !sd.gender) {
                const ss = safeParse(sessionStorage.getItem('studentData'));
                if (ss.studentName && ss.gender) {
                    console.warn('‚ÑπÔ∏è Subjects: restoring studentData from sessionStorage on load');
                    try { localStorage.setItem('studentData', JSON.stringify(ss)); } catch {}
                    sd = ss;
                }
            }
            console.log('üëÄ Subjects page sees studentData:', sd);
        });

        function saveSelections() {
            const selectedTopics = [];
            const selectedSubjects = [];
            
            document.querySelectorAll('.topic-checkbox:checked').forEach(checkbox => {
                selectedTopics.push(checkbox.value);
            });
            
            document.querySelectorAll('.subject-checkbox:checked').forEach(checkbox => {
                selectedSubjects.push(checkbox.value);
            });
            
            localStorage.setItem('selectedSubjects', JSON.stringify(selectedTopics));
            localStorage.setItem('selectedSubjectTitles', JSON.stringify(selectedSubjects));
            updateSelections();
        }

        function updateSelections() {
            updateSelectionCount();
        }

        // selectAll and clearAll functions are now loaded from missing-functions.js
        // refreshReport function is now loaded from missing-functions.js

        // startOver function is now loaded from missing-functions.js

        function updateSelectionCount() {
            const count = document.querySelectorAll('.topic-checkbox:checked').length;
            const countElement = document.getElementById('selectionCount');
            if (countElement) {
                countElement.textContent = count;
            }
        }

        function loadSelections() {
            const savedTopics = localStorage.getItem('selectedSubjects');
            const savedSubjects = localStorage.getItem('selectedSubjectTitles');
            
            // First, ensure all dropdowns are closed
            document.querySelectorAll('.subject-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.dropdown-arrow').forEach(arrow => {
                arrow.classList.remove('rotated');
            });
            
            if (savedTopics) {
                const selectedValues = JSON.parse(savedTopics);
                document.querySelectorAll('.topic-checkbox').forEach(checkbox => {
                    if (selectedValues.includes(checkbox.value)) {
                        checkbox.checked = true;
                    }
                });
            }
            
            if (savedSubjects) {
                const selectedSubjects = JSON.parse(savedSubjects);
                document.querySelectorAll('.subject-checkbox').forEach(checkbox => {
                    if (selectedSubjects.includes(checkbox.value)) {
                        checkbox.checked = true;
                        const subjectId = checkbox.id.replace('subject_', '');
                        handleSubjectCheck(subjectId);
                    }
                });
            }
            
            updateSelectionCount();
        }

        // updateSelectionCount function moved to top of script

        // duplicate function removed

        // selectAll function moved to top of script

        // clearAll function moved to top of script

        // saveSelections function moved to top of script
        // loadSelections function moved to top of script

        // ensureCommentGeneration function is now loaded from missing-functions.js

        // selectComment function is now loaded from missing-functions.js

        // copySelectedComment function is now loaded from missing-functions.js

        // goBack function is now loaded from missing-functions.js

        function generateComment(studentData, selectedTopics, selectedSubjects, variant) {
            const name = studentData.studentName || 'The student';
            const gender = studentData.gender || 'they';

            // Pronoun setup
            const pronouns = {
                he: { subject: 'He', object: 'him', possessive: 'his', verb: 'has', isAre: 'is' },
                she: { subject: 'She', object: 'her', possessive: 'her', verb: 'has', isAre: 'is' },
                they: { subject: 'They', object: 'them', possessive: 'their', verb: 'have', isAre: 'are' }
            };
            const p = pronouns[gender] || pronouns.they;

            const overall = parseInt(studentData.overallAttributes || 5);
            const strengths = studentData.strengths || '';
            
            const subjectData = selectedSubjects || [];

            function capitalizeSubjects(subjectList) {
                return subjectList.map(subject => {
                    const lower = subject.toLowerCase();
                    const specialCases = { 'english': 'English', 'mathematics': 'Mathematics', 'phonics': 'Phonics', 'science': 'Science', 'social studies': 'Social Studies', 'i.q': 'I.Q', 'physical education': 'Physical Education' };
                    if (specialCases[lower]) return specialCases[lower];
                    if (lower.includes('conversation')) return subject.charAt(0).toUpperCase() + subject.slice(1);
                    return subject.charAt(0).toUpperCase() + subject.slice(1);
                });
            }

            const performanceMap = {
                10: { level: 'exceptional' }, 9: { level: 'excellent' }, 8: { level: 'very strong' },
                7: { level: 'strong' }, 6: { level: 'good' }, 5: { level: 'satisfactory' },
                4: { level: 'developing' }, 3: { level: 'basic' }, 2: { level: 'beginning' }, 1: { level: 'emerging' }
            };
            
            const perf = performanceMap[overall] || performanceMap[5];
            const isMaleTeacher = variant === 1;

            // Helper to join lists naturally
            function naturalJoin(arr) {
                if (arr.length === 0) return '';
                if (arr.length === 1) return arr[0];
                if (arr.length === 2) return arr.join(' and ');
                return `${arr.slice(0, -1).join(', ')}, and ${arr.slice(-1)}`;
            }

            // Generate concise comment with maximum 80 words
            let comment;
            
            if (isMaleTeacher) {
                comment = `${name} demonstrated ${perf.level} performance this term across multiple learning areas.`;
                
                if (strengths.trim()) {
                    const strengthList = strengths.split(',').map(s => s.trim().toLowerCase()).filter(Boolean).slice(0, 2);
                    if (strengthList.length > 0) {
                        comment += ` ${p.subject} shows strong capabilities in ${naturalJoin(strengthList)}.`;
                    }
                }
                
                if (subjectData.length > 0) {
                    const capitalizedSubjects = capitalizeSubjects(subjectData.slice(0, 2));
                    comment += ` In ${naturalJoin(capitalizedSubjects)}, ${name} shows consistent growth.`;
                }
                
                comment += ` ${name} shows excellent potential for continued learning success.`;
            } else {
                comment = `It has been a pleasure watching ${name} grow this term.`;
                
                if (strengths.trim()) {
                    const strengthList = strengths.split(',').map(s => s.trim().toLowerCase()).filter(Boolean).slice(0, 2);
                    if (strengthList.length > 0) {
                        comment += ` ${p.possessive} talent for ${naturalJoin(strengthList)} truly shines.`;
                    }
                }
                
                if (subjectData.length > 0) {
                    const capitalizedSubjects = capitalizeSubjects(subjectData.slice(0, 2));
                    comment += ` ${p.subject} has shown wonderful progress in ${naturalJoin(capitalizedSubjects)}.`;
                }
                
                comment += ` ${name} brings joy to learning and shows wonderful potential for future success.`;
            }

            // Ensure proper ending punctuation
            if (!/[.!?]$/.test(comment)) {
                comment = comment.replace(/[,;:]\s*$/, '') + '.';
            }

            return comment;
        }

        // generateComments function is now handled by optimized-comment-generator.js

        // toggleSubject and handleSubjectCheck functions moved to top of script

        // Load saved selections on page load
        window.addEventListener('load', loadSelections);
        
        // startOver function moved to top of script
        
        // selectComment function is now loaded from missing-functions.js

        // copySelectedComment function is now loaded from missing-functions.js

        // All functions are now loaded from missing-functions.js
        
        // Initialize page when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Subjects page JavaScript initialized');
        });
    </script>
    <script src="localstorage-monitor.js"></script>
    <script src="assets/js/comment-engine.js"></script>
    <script src="enhanced-comment-engine.js"></script>
    <script src="optimized-comment-generator.js"></script>
    <script src="missing-functions.js"></script>
</body>
</html>
