<!DOCTYPE html>
<html lang="en" spellcheck="false">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enter student information for premium report generation">
    <title>üìÑ Student Information - Teachers Pet</title>

    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/css/main.css" as="style">
    <link rel="preload" href="assets/css/components.css" as="style">
    <!-- <link rel="preload" href="assets/js/controllers/app-controller.js" as="script"> -->
    <link rel="preload" href="assets/js/comment-engine.js" as="script">

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <!-- Mythology Theme -->
    <link rel="stylesheet" href="assets/css/mythology-theme.css">
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        /* Dark Space Background */
        background:
            linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.8)),
            url('https://images.unsplash.com/photo-1536514498073-50e69d39c6cf?q=80&w=2000&auto=format&fit=crop') center/cover no-repeat fixed;
        min-height: 100vh;
        padding: 20px;
        margin: 0;
        position: relative;
        overflow-x: hidden;
    }

    /* Space stars animation */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
            radial-gradient(2px 2px at 20px 30px, rgba(255, 255, 255, 0.8), transparent),
            radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.6), transparent),
            radial-gradient(1px 1px at 90px 40px, rgba(255, 255, 255, 0.5), transparent),
            radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.4), transparent),
            radial-gradient(2px 2px at 160px 30px, rgba(255, 255, 255, 0.7), transparent);
        background-repeat: repeat;
        background-size: 200px 200px;
        animation: twinkle 20s linear infinite;
        pointer-events: none;
        z-index: 1;
        will-change: transform, opacity;
    }

    @keyframes twinkle {
        0% {
            transform: translate3d(0px, 0px, 0) rotate(0deg);
            opacity: 0.8;
        }

        50% {
            opacity: 1;
        }

        100% {
            transform: translate3d(100px, -200px, 0) rotate(360deg);
            opacity: 0.8;
        }
    }

    .container {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(20px);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        padding: 30px;
        max-width: 800px;
        margin: 0 auto;
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.3),
            0 0 50px rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 10;
    }

    h1 {
        color: #2c3e50;
        font-size: 2.2em;
        margin-bottom: 25px;
        font-weight: 600;
        text-align: center;
        font-family: 'Segoe UI', sans-serif;
    }

    .form-group {
        margin-bottom: 20px;
        position: relative;
    }

    .auto-save-indicator {
        position: absolute;
        top: -5px;
        right: 0;
        background: #27ae60;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 11px;
        opacity: 0;
        transition: opacity 0.3s ease;
        font-weight: 500;
    }

    .auto-save-indicator.show {
        opacity: 1;
    }

    .form-progress {
        background: #f8f9fa;
        border: 1px solid #e0e6ed;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border-left: 4px solid #3498db;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e6ed;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #27ae60);
        width: 0%;
        transition: width 0.3s ease;
    }

    .validation-message {
        color: #e74c3c;
        font-size: 12px;
        margin-top: 5px;
        display: none;
        font-weight: 500;
    }

    .field-valid {
        border-color: #27ae60 !important;
    }

    .field-invalid {
        border-color: #e74c3c !important;
    }

    label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #34495e;
        font-size: 14px;
        font-family: 'Segoe UI', sans-serif;
    }

    input[type="text"],
    textarea,
    select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        font-size: 14px;
        box-sizing: border-box;
        background: #fff;
        color: #2c3e50;
        transition: all 0.3s ease;
        font-family: 'Segoe UI', sans-serif;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    input[type="text"]::placeholder,
    textarea::placeholder {
        color: #95a5a6;
    }

    textarea {
        height: 80px;
        resize: vertical;
        font-family: 'Segoe UI', sans-serif;
    }

    .slider-container {
        margin-top: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e0e6ed;
    }

    .slider {
        width: 100%;
        height: 6px;
        border-radius: 6px;
        background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
        outline: none;
        -webkit-appearance: none;
        appearance: none;
        position: relative;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        border: 2px solid white;
        transition: all 0.3s ease;
    }

    .slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
    }

    .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        border: 2px solid white;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
    }

    .slider-value {
        text-align: center;
        font-size: 18px;
        font-weight: 600;
        color: #3498db;
        margin-top: 8px;
        font-family: 'Segoe UI', sans-serif;
    }

    .button {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        font-family: 'Segoe UI', sans-serif;
        margin: 8px 4px;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
    }

    .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }

    .button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    .button-secondary {
        background: linear-gradient(135deg, #27ae60, #229954);
        box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
    }

    .button-secondary:hover {
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    }

    .quick-select-btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 16px;
        cursor: pointer;
        font-size: 12px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 500;
        transition: all 0.3s ease;
        margin: 2px;
        box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3);
    }

    .quick-select-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(52, 152, 219, 0.4);
    }

    .improvement-btn {
        background: linear-gradient(135deg, #e67e22, #d35400);
        box-shadow: 0 2px 5px rgba(230, 126, 34, 0.3);
    }

    .improvement-btn:hover {
        box-shadow: 0 3px 8px rgba(230, 126, 34, 0.4);
    }

    /* Category Section Styles */
    .category-section {
        margin-bottom: 12px;
        border: 1px solid #e0e6ed;
        border-radius: 8px;
        overflow: hidden;
        background: #fff;
    }

    .category-header {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 10px 15px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        color: #2c3e50;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        transition: all 0.2s ease;
        border-bottom: 1px solid #e0e6ed;
        border: none;
        border-bottom: 1px solid #e0e6ed;
        width: 100%;
        text-align: left;
        font-family: inherit;
    }

    .category-header:hover {
        background: linear-gradient(135deg, #e9ecef, #dee2e6);
    }

    .category-header:focus {
        outline: 2px solid #3498db;
        outline-offset: 2px;
    }

    .category-header .emoji {
        margin-right: 6px;
        font-size: 14px;
    }

    .toggle-icon {
        font-size: 12px;
        transition: transform 0.3s ease;
        color: #7f8c8d;
    }

    .category-header.collapsed .toggle-icon {
        transform: rotate(-90deg);
    }

    .category-content {
        padding: 12px;
        background: #fafbfc;
        max-height: 500px;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
    }

    .category-content.collapsed {
        max-height: 0;
        padding: 0 12px;
    }

    .button-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 6px;
    }

    .strength-btn {
        background: linear-gradient(135deg, #27ae60, #229954);
        box-shadow: 0 2px 5px rgba(39, 174, 96, 0.3);
    }

    .strength-btn:hover {
        box-shadow: 0 3px 8px rgba(39, 174, 96, 0.4);
    }

    .clear-btn {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        font-size: 11px;
        padding: 4px 10px;
        margin-top: 8px;
        box-shadow: 0 2px 5px rgba(149, 165, 166, 0.3);
    }

    .clear-btn:hover {
        box-shadow: 0 3px 8px rgba(149, 165, 166, 0.4);
    }

    .navigation {
        text-align: center;
        margin: 25px 0;
        padding: 20px;
        border-top: 2px solid #e0e6ed;
        position: relative;
    }

    .info-section {
        background: #f8f9fa;
        border: 1px solid #e0e6ed;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #3498db;
    }

    .info-section h3 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 8px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 600;
        font-size: 16px;
    }

    .info-section p {
        color: #7f8c8d;
        margin-bottom: 0;
        line-height: 1.5;
        font-family: 'Segoe UI', sans-serif;
        font-size: 14px;
    }

    .status-indicator {
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 12px;
        margin-left: 10px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 600;
        border: 1px solid;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
        border-color: #ffeaa7;
    }

    .status-complete {
        background: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }

    /* Grid Layout Classes */
    .grid-2fr-1fr {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .grid-1fr-1fr {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    /* Utility Classes */
    .margin-bottom-0 {
        margin-bottom: 0 !important;
    }

    .margin-bottom-8 {
        margin-bottom: 8px;
    }

    .flex-gap-8 {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .margin-0 {
        margin: 0;
    }

    .color-secondary {
        color: #7f8c8d;
    }

    .font-size-14 {
        font-size: 14px;
    }

    .float-right {
        float: right;
    }

    .font-weight-600 {
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
            margin: 10px;
        }

        h1 {
            font-size: 1.8em;
        }

        .grid-2fr-1fr,
        .grid-1fr-1fr {
            grid-template-columns: 1fr !important;
            gap: 15px !important;
        }

        .quick-select-btn {
            font-size: 11px;
            padding: 5px 10px;
        }

        .slider {
            height: 8px;
        }

        .progress-bar {
            height: 6px;
        }
    }

    /* Modal Overlay */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease;
    }

    .modal-overlay.show {
        display: flex;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    /* Modal Content */
    .modal-content {
        background: rgba(255, 255, 255, 0.95);
        -webkit-backdrop-filter: blur(20px);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 16px;
        padding: 35px;
        max-width: 600px;
        width: 90%;
        box-shadow:
            0 20px 60px rgba(0, 0, 0, 0.5),
            0 0 100px rgba(255, 255, 255, 0.2);
        position: relative;
        z-index: 1001;
        animation: slideDown 0.4s ease;
    }

    @keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .modal-title {
        color: #2c3e50;
        font-size: 1.8em;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 700;
        font-family: 'Segoe UI', sans-serif;
    }

    .modal-body {
        margin-bottom: 25px;
    }

    .warning-text,
    .info-text,
    .tip-text {
        color: #000;
        font-size: 15px;
        line-height: 1.7;
        margin-bottom: 15px;
        font-family: 'Segoe UI', sans-serif;
        font-weight: 600;
    }

    .warning-text {
        font-weight: 700;
    }

    .pulsating-red {
        animation: pulsateRed 1.5s ease-in-out infinite;
    }

    @keyframes pulsateRed {

        0%,
        100% {
            color: #e74c3c;
            text-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        50% {
            color: #c0392b;
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.8);
        }
    }

    .info-text {
        color: #2c3e50;
    }

    .tip-text {
        color: #27ae60;
        font-style: italic;
    }

    .modal-footer {
        text-align: center;
    }

    .button-acknowledge {
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
        padding: 14px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 700;
        font-family: 'Segoe UI', sans-serif;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
    }

    .button-acknowledge:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(39, 174, 96, 0.6);
    }
</style>
<link rel="stylesheet" href="styles/inline-fixes.css">
<script src="missing-functions.js"></script>
</head>

<body>
    <div class="container">
        <h1>Kindergarten Report Generator</h1>

        <!-- Curriculum Tracker -->
        <div id="curriculumTracker" style="margin-bottom:12px;"></div>

        <!-- Progress Indicator -->
        <div class="form-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="margin-0 color-secondary font-size-14">
                <span id="progressText">Complete the form to continue</span>
                <span class="float-right font-weight-600"><span id="progressPercent">0</span>%</span>
            </p>
        </div>

        <form id="studentForm">
            <!-- Basic Information Grid -->
            <div class="grid-2fr-1fr">
                <div class="form-group margin-bottom-0">
                    <label for="studentName">Student Name:</label>
                    <input type="text" id="studentName" name="studentName">
                    <div class="auto-save-indicator" id="nameIndicator">Saved</div>
                </div>
                <div class="form-group margin-bottom-0">
                    <label for="gender">Gender:</label>
                    <select id="gender" name="gender">
                        <option value="">Select gender...</option>
                        <option value="he">He</option>
                        <option value="she">She</option>
                        <option value="they">They</option>
                    </select>
                    <div class="auto-save-indicator" id="genderIndicator">Saved</div>
                </div>
            </div>

            <!-- Overall Attributes -->
            <div class="form-group">
                <label for="overallAttributes">Overall Attributes (1-10):</label>
                <div class="slider-container">
                    <input type="range" id="overallAttributes" name="overallAttributes" min="1" max="10" value="5"
                        class="slider">
                    <div class="slider-value" id="sliderValue">5</div>
                </div>
            </div>

            <!-- Strengths and Areas for Improvement Grid -->
            <div class="grid-1fr-1fr">
                <div class="form-group margin-bottom-0">
                    <label for="strengths">Strengths: <button type="button" class="clear-btn"
                            onclick="clearStrengths()">Clear All</button></label>
                    <div class="margin-bottom-8">
                        <!-- Cognitive/Academic -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="cognitive-strengths" tabindex="0"
                                onclick="toggleCategory('cognitive-strengths')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('cognitive-strengths');}">
                                <span><span class="emoji">üß†</span>Cognitive/Academic</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="cognitive-strengths" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('creative thinking and imagination')">Creative</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('curious and inquisitive nature')">Curious</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('focused and attentive learner')">Focused</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('thoughtful and reflective approach')">Thoughtful</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('independent learning skills')">Independent</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('strong problem-solving abilities')">Problem-Solving</button>
                                </div>
                            </div>
                        </div>

                        <!-- Social-Emotional -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="social-strengths" tabindex="0"
                                onclick="toggleCategory('social-strengths')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('social-strengths');}">
                                <span><span class="emoji">ü§ù</span>Social-Emotional</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="social-strengths" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('strong social skills')">Social Skills</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('cooperative team player')">Cooperative</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('cheerful and positive attitude')">Cheerful</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('friendly and welcoming')">Friendly</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('gentle and caring nature')">Gentle</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('respectful and courteous')">Respectful</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('patient with peers')">Patient</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('confident self-expression')">Confident</button>
                                </div>
                            </div>
                        </div>

                        <!-- Physical/Motor -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="physical-strengths" tabindex="0"
                                onclick="toggleCategory('physical-strengths')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('physical-strengths');}">
                                <span><span class="emoji">üí™</span>Physical/Motor</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="physical-strengths" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('excellent fine motor skills')">Fine Motor</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('active and energetic participation')">Active</button>
                                </div>
                            </div>
                        </div>

                        <!-- Communication/Expression -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="communication-strengths" tabindex="0"
                                onclick="toggleCategory('communication-strengths')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('communication-strengths');}">
                                <span><span class="emoji">üí¨</span>Communication/Expression</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="communication-strengths" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('good listening skills')">Listening</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('expressive communication')">Expressive</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('enthusiastic participation')">Enthusiastic</button>
                                </div>
                            </div>
                        </div>

                        <!-- Character Traits -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="character-strengths" tabindex="0"
                                onclick="toggleCategory('character-strengths')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('character-strengths');}">
                                <span><span class="emoji">‚≠ê</span>Character Traits</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="character-strengths" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('helpful and kind disposition')">Helpful</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('natural leadership qualities')">Leadership</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('brave and willing to try new things')">Brave</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('diligent and hardworking')">Diligent</button>
                                    <button type="button" class="quick-select-btn strength-btn"
                                        onclick="addToStrengths('consistent effort and engagement')">Consistent</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <textarea id="strengths" name="strengths"
                        placeholder="Select from categories above or type custom strengths..."></textarea>
                    <div class="auto-save-indicator" id="strengthsIndicator">Saved</div>
                </div>

                <div class="form-group margin-bottom-0">
                    <label for="weaknesses">Areas for Improvement: <button type="button" class="clear-btn"
                            onclick="clearWeaknesses()">Clear All</button></label>
                    <div class="margin-bottom-8">
                        <!-- Fine Motor Development -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="motor-improvements" tabindex="0"
                                onclick="toggleCategory('motor-improvements')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('motor-improvements');}">
                                <span><span class="emoji">‚úÇÔ∏è</span>Fine Motor Development</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="motor-improvements" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('refining motor skills')">Motor Skills</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('developing cutting and pasting skills')">Cutting/Pasting</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('building pencil control')">Pencil Control</button>
                                </div>
                            </div>
                        </div>

                        <!-- Social-Emotional Growth -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="social-improvements" tabindex="0"
                                onclick="toggleCategory('social-improvements')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('social-improvements');}">
                                <span><span class="emoji">üå±</span>Social-Emotional Growth</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="social-improvements" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('developing social awareness')">Social Awareness</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('building confidence in group settings')">Group
                                        Confidence</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('learning to share and take turns')">Sharing/Turns</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('managing emotions appropriately')">Emotion
                                        Management</button>
                                </div>
                            </div>
                        </div>

                        <!-- Communication Skills -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="communication-improvements" tabindex="0"
                                onclick="toggleCategory('communication-improvements')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('communication-improvements');}">
                                <span><span class="emoji">üó£Ô∏è</span>Communication Skills</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="communication-improvements" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('practicing active listening')">Active Listening</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('improving verbal expression')">Verbal Expression</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('following multi-step directions')">Following
                                        Directions</button>
                                </div>
                            </div>
                        </div>

                        <!-- Cognitive Development -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="cognitive-improvements" tabindex="0"
                                onclick="toggleCategory('cognitive-improvements')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('cognitive-improvements');}">
                                <span><span class="emoji">üß©</span>Cognitive Development</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="cognitive-improvements" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('improving spatial awareness')">Spatial Awareness</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('building attention span')">Attention Span</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('developing organizational skills')">Organization</button>
                                </div>
                            </div>
                        </div>

                        <!-- Independence/Self-Regulation -->
                        <div class="category-section">
                            <button type="button" class="category-header" role="button" aria-expanded="false"
                                aria-controls="independence-improvements" tabindex="0"
                                onclick="toggleCategory('independence-improvements')"
                                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleCategory('independence-improvements');}">
                                <span><span class="emoji">üéØ</span>Independence/Self-Regulation</span>
                                <span class="toggle-icon">‚ñº</span>
                            </button>
                            <div id="independence-improvements" class="category-content">
                                <div class="button-grid">
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('building self-confidence')">Self-Confidence</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('developing independent work habits')">Independent
                                        Work</button>
                                    <button type="button" class="quick-select-btn improvement-btn"
                                        onclick="addToAreas('improving impulse control')">Impulse Control</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <textarea id="weaknesses" name="weaknesses"
                        placeholder="Select from categories above or type custom areas for improvement..."></textarea>
                    <div class="auto-save-indicator" id="weaknessesIndicator">Saved</div>
                </div>
            </div>
        </form>

        <div class="navigation">
            <button type="button" class="button button-secondary" onclick="goToSubjects()">
                Continue to Subject Selection ‚Üí
                <span id="subjectsStatus" class="status-indicator status-pending">Required</span>
            </button>
        </div>

        <div class="info-section">
            <h3>Next Steps:</h3>
            <p>After completing this form, you'll select subjects and topics to include in the report, then generate
                personalized comments.</p>
        </div>
    </div>

    <!-- Acknowledgment Modal -->
    <div id="acknowledgmentModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="modal-title">‚ö†Ô∏è Important Notice</h2>
            <div class="modal-body">
                <p class="warning-text pulsating-red">*COMMENTS ARE NOT GENERATED USING AI. PLEASE REVIEW YOUR COMMENTS!
                </p>
                <p class="info-text">*The more boxes you tick, the larger the comments. Sangsom School report only
                    requires 75 - 80 words. Tick/select lightly.</p>
                <p class="tip-text">**Tip - leave strengths and weaknesses empty in the previous student information
                    page.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="button button-acknowledge" onclick="acknowledgeAndProceed()">
                    I Understand - Continue ‚Üí
                </button>
            </div>
        </div>
    </div>

    <script>
        let autoSaveTimeout;

        function updateCurriculumTracker() {
            // Get grade and month from URL params or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            let grade = urlParams.get('grade');
            let month = urlParams.get('month');

            if (!grade || !month) {
                try {
                    const savedData = localStorage.getItem('studentData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        grade = grade || data.grade;
                        month = month || data.month;
                    }
                } catch (e) {
                    console.warn('Could not read curriculum info:', e);
                }
            }

            // Display curriculum tracker if grade and month are available
            const tracker = document.getElementById('curriculumTracker');
            if (tracker && grade && month) {
                tracker.innerHTML = `<span style="background:rgba(0,0,0,0.07);border-radius:16px;padding:4px 12px;font-weight:600;display:inline-block;">Current: <span style='color:#2a7cff'>${grade}</span> ¬∑ <span style='color:#ff7c2a'>${month}</span> <a href='month-selection.html?grade=${encodeURIComponent(grade)}' style='margin-left:8px;font-size:13px;'>Change</a></span>`;
                console.log(`üìö Curriculum tracker updated: ${grade} - ${month}`);
            }
        }

        document.getElementById('overallAttributes').addEventListener('input', function () {
            document.getElementById('sliderValue').textContent = this.value;
            autoSaveFormData();
        });

        // Enhanced auto-save with visual feedback
        document.addEventListener('input', function (e) {
            if (e.target.matches('#studentName, #gender, #strengths, #weaknesses, #overallAttributes')) {
                validateField(e.target);
                autoSaveFormData();
            }
        });

        document.addEventListener('change', function (e) {
            if (e.target.matches('#studentName, #gender, #strengths, #weaknesses, #overallAttributes')) {
                validateField(e.target);
                autoSaveFormData();
            }
        });

        function validateField(field) {
            const fieldName = field.id;
            const value = field.value.trim();

            // Clear previous validation styles
            field.classList.remove('field-valid', 'field-invalid');
            const validationMsg = document.getElementById(fieldName + 'Validation');
            if (validationMsg) {
                validationMsg.style.display = 'none';
            }

            // Mark field as valid if it has content
            if (value) {
                field.classList.add('field-valid');
            }

            updateProgress();
            return true;
        }



        function showAutoSaveIndicator() {
            // Show save indicators briefly
            document.querySelectorAll('.auto-save-indicator').forEach(indicator => {
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 1500);
            });
        }

        function updateProgress() {
            const fields = ['studentName', 'gender', 'strengths', 'weaknesses', 'overallAttributes'];
            let completed = 0;

            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field && field.value.trim()) {
                    completed++;
                }
            });

            const percentage = Math.round((completed / fields.length) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressPercent').textContent = percentage;

            const progressText = document.getElementById('progressText');
            if (percentage === 100) {
                progressText.textContent = 'Form completed! Ready to continue.';
                progressText.style.color = '#27ae60';
            } else if (percentage >= 40) {
                progressText.textContent = 'Great progress! Keep going.';
                progressText.style.color = '#f39c12';
            } else {
                progressText.textContent = 'Complete the form to continue';
                progressText.style.color = '#7f8c8d';
            }
        }

        function saveFormData() {
            try {
                // Get grade and month from URL params or existing localStorage
                const urlParams = new URLSearchParams(window.location.search);
                let grade = urlParams.get('grade');
                let month = urlParams.get('month');

                // Fallback to existing localStorage if URL params missing
                if (!grade || !month) {
                    try {
                        const existingData = localStorage.getItem('studentData');
                        if (existingData) {
                            const parsed = JSON.parse(existingData);
                            grade = grade || parsed.grade;
                            month = month || parsed.month;
                        }
                    } catch (e) {
                        console.warn('Could not parse existing studentData:', e);
                    }
                }

                // Collect all form fields with proper validation
                const formData = {
                    grade: grade || '',
                    month: month || '',
                    studentName: document.getElementById('studentName').value.trim(),
                    gender: document.getElementById('gender').value,
                    strengths: document.getElementById('strengths').value.trim(),
                    weaknesses: document.getElementById('weaknesses').value.trim(),
                    overallAttributes: document.getElementById('overallAttributes').value,
                    timestamp: Date.now(),
                    version: '1.0'
                };

                // Basic validation - ensure student name is provided
                if (!formData.studentName) {
                    console.warn('Student name is required for saving');
                    return false;
                }

                // Validate overall attributes is a valid number
                const attributes = parseInt(formData.overallAttributes);
                if (isNaN(attributes) || attributes < 1 || attributes > 10) {
                    console.warn('Invalid overall attributes value, using default');
                    formData.overallAttributes = '5';
                }

                console.log('Saving form data:', formData);
                console.log('Student name being saved:', formData.studentName);

                // Save to localStorage and sessionStorage with error handling
                const serialized = JSON.stringify(formData);
                localStorage.setItem('studentData', serialized);
                try { sessionStorage.setItem('studentData', serialized); } catch { }

                // Verify the data was saved correctly
                const savedData = localStorage.getItem('studentData');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    if (parsed.studentName !== formData.studentName) {
                        console.error('Data integrity check failed after save');
                        return false;
                    }
                }

                checkFormComplete();
                return true;

            } catch (error) {
                console.error('Error saving form data:', error);
                alert('An error occurred while saving your information. Please try again.');
                return false;
            }
        }



        function loadFormData() {
            console.log('üîÑ Loading form data...');

            // Check if this is a fresh start (coming from "Start Over" button)
            const urlParams = new URLSearchParams(window.location.search);
            const fromIndex = document.referrer.includes('index.html') || document.referrer === '';

            // If coming from index page or URL has fresh parameter, clear any existing data
            if (fromIndex || urlParams.has('fresh')) {
                console.log('üßπ Fresh start detected - clearing any existing data');
                localStorage.clear();
                sessionStorage.clear();
                // Remove the URL parameter if it exists
                if (urlParams.has('fresh')) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }

            // Update curriculum tracker display
            updateCurriculumTracker();

            try {
                const saved = localStorage.getItem('studentData');
                console.log('Raw localStorage data:', saved);

                if (!saved) {
                    console.log('‚ùå No saved student data found');
                    checkSubjectsStatus();
                    checkFormComplete();
                    updateProgress();
                    return true;
                }

                const data = JSON.parse(saved);
                console.log('‚úÖ Parsed form data:', data);

                // Check if form elements exist before trying to populate them
                const elements = {
                    studentName: document.getElementById('studentName'),
                    gender: document.getElementById('gender'),
                    strengths: document.getElementById('strengths'),
                    weaknesses: document.getElementById('weaknesses'),
                    overallAttributes: document.getElementById('overallAttributes'),
                    sliderValue: document.getElementById('sliderValue')
                };

                console.log('Form elements found:', Object.keys(elements).filter(key => elements[key]));

                // Restore form fields with verification
                if (elements.studentName) {
                    elements.studentName.value = data.studentName || '';
                    console.log('‚úÖ Restored studentName:', elements.studentName.value);
                }

                if (elements.gender) {
                    elements.gender.value = data.gender || '';
                    console.log('‚úÖ Restored gender:', elements.gender.value);
                }

                if (elements.strengths) {
                    elements.strengths.value = data.strengths || '';
                    console.log('‚úÖ Restored strengths:', elements.strengths.value);
                }

                if (elements.weaknesses) {
                    elements.weaknesses.value = data.weaknesses || '';
                    console.log('‚úÖ Restored weaknesses:', elements.weaknesses.value);
                }

                if (elements.overallAttributes) {
                    const attributeValue = data.overallAttributes || '5';
                    elements.overallAttributes.value = attributeValue;
                    console.log('‚úÖ Restored overallAttributes:', attributeValue);

                    if (elements.sliderValue) {
                        elements.sliderValue.textContent = attributeValue;
                        console.log('‚úÖ Updated slider display:', attributeValue);
                    }
                }

                // Validate loaded fields
                document.querySelectorAll('#studentName, #gender, #strengths, #weaknesses').forEach(field => {
                    if (field) {
                        validateField(field);
                        console.log('‚úÖ Validated field:', field.id, 'value:', field.value);
                    }
                });

                console.log('‚úÖ Form data loading completed successfully');

            } catch (error) {
                console.error('‚ùå Error loading form data:', error);
                console.log('üóëÔ∏è Removing corrupted data from localStorage');
                localStorage.removeItem('studentData');
            }

            checkSubjectsStatus();
            checkFormComplete();
            updateProgress();
        }

        function checkSubjectsStatus() {
            const subjects = localStorage.getItem('selectedSubjects');
            const subjectTitles = localStorage.getItem('selectedSubjectTitles');
            const statusIndicator = document.getElementById('subjectsStatus');

            if ((subjects && JSON.parse(subjects).length > 0) || (subjectTitles && JSON.parse(subjectTitles).length > 0)) {
                statusIndicator.textContent = 'Complete';
                statusIndicator.className = 'status-indicator status-complete';
            } else {
                statusIndicator.textContent = 'Required';
                statusIndicator.className = 'status-indicator status-pending';
            }
        }

        function checkFormComplete() {
            const name = document.getElementById('studentName').value;
            const gender = document.getElementById('gender').value;

            const continueBtn = document.querySelector('.button-secondary');
            if (name && gender) {
                continueBtn.style.opacity = '1';
                continueBtn.style.pointerEvents = 'auto';
                continueBtn.style.transform = 'none';
            } else {
                continueBtn.style.opacity = '0.6';
                continueBtn.style.pointerEvents = 'none';
                continueBtn.style.transform = 'scale(0.98)';
            }
        }

        function goToSubjects() {
            const studentName = document.getElementById('studentName').value.trim();
            const gender = document.getElementById('gender').value;

            if (!studentName) {
                alert('Please enter the student name before continuing.');
                document.getElementById('studentName').focus();
                return;
            }

            if (!gender) {
                alert('Please select the student gender before continuing.');
                document.getElementById('gender').focus();
                return;
            }

            // Persist once more before showing modal
            saveFormData();
            try {
                const serialized = localStorage.getItem('studentData');
                if (serialized) sessionStorage.setItem('studentData', serialized);
            } catch { }

            // Show acknowledgment modal instead of immediately navigating
            showAcknowledgmentModal();
        }

        function showAcknowledgmentModal() {
            // Check if user has already acknowledged recently (within 30 days)
            const lastAck = localStorage.getItem('acknowledgmentTimestamp');
            if (lastAck) {
                const daysSince = (Date.now() - parseInt(lastAck)) / (1000 * 60 * 60 * 24);
                if (daysSince < 30) {
                    console.log('Skipping acknowledgment modal (acknowledged ' + Math.round(daysSince) + ' days ago)');
                    acknowledgeAndProceed(true);
                    return;
                }
            }

            const modal = document.getElementById('acknowledgmentModal');
            modal.classList.add('show');
        }

        function acknowledgeAndProceed(skipUpdate) {
            // Save timestamp to prevent showing again for 30 days
            if (skipUpdate !== true) {
                localStorage.setItem('acknowledgmentTimestamp', Date.now().toString());
            }

            // Hide modal
            const modal = document.getElementById('acknowledgmentModal');
            modal.classList.remove('show');

            // Get grade and month from URL params, localStorage, or defaults
            const urlParams = new URLSearchParams(window.location.search);
            let grade = urlParams.get('grade');
            let month = urlParams.get('month');

            // Fallback to localStorage if URL params missing
            if (!grade || !month) {
                try {
                    const savedData = localStorage.getItem('studentData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        grade = grade || data.grade;
                        month = month || data.month;
                    }
                } catch (e) {
                    console.warn('Could not read grade/month from localStorage:', e);
                }
            }

            // Final fallback to defaults only if still not set
            grade = grade || 'K1';
            month = month || 'August';

            console.log(`üìö Navigating to Subjects.html with: ${grade} - ${month}`);
            window.location.href = `Subjects.html?grade=${grade}&month=${month}`;
        }

        function addToAreas(text) {
            const textarea = document.getElementById('weaknesses');
            const currentValue = textarea.value.trim();

            if (currentValue.includes(text)) return;

            textarea.value = currentValue === '' ? text : currentValue + ', ' + text;
            validateField(textarea);
            autoSaveFormData();
        }

        function addToStrengths(text) {
            const textarea = document.getElementById('strengths');
            const currentValue = textarea.value.trim();

            if (currentValue.includes(text)) return;

            textarea.value = currentValue === '' ? text : currentValue + ', ' + text;
            validateField(textarea);
            autoSaveFormData();
        }

        // Category toggle function with ARIA state management
        function toggleCategory(categoryId) {
            const content = document.getElementById(categoryId);
            const header = content.previousElementSibling;
            const isCollapsed = content.classList.contains('collapsed');

            if (isCollapsed) {
                content.classList.remove('collapsed');
                header.classList.remove('collapsed');
                header.setAttribute('aria-expanded', 'true');
            } else {
                content.classList.add('collapsed');
                header.classList.add('collapsed');
                header.setAttribute('aria-expanded', 'false');
            }
        }

        // Clear functions
        function clearStrengths() {
            const textarea = document.getElementById('strengths');
            textarea.value = '';
            validateField(textarea);
            autoSaveFormData();
        }

        function clearWeaknesses() {
            const textarea = document.getElementById('weaknesses');
            textarea.value = '';
            validateField(textarea);
            autoSaveFormData();
        }

        // Enhanced auto-save with better error handling
        function autoSaveFormData() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                saveFormData();
                showAutoSaveIndicator();
            }, 500);
        }

        // Debug function to check localStorage
        function debugLocalStorage() {
            console.log('=== LocalStorage Debug ===');
            console.log('studentData:', localStorage.getItem('studentData'));
            console.log('All localStorage keys:', Object.keys(localStorage));

            // Test localStorage functionality
            try {
                localStorage.setItem('test', 'working');
                const test = localStorage.getItem('test');
                localStorage.removeItem('test');
                console.log('LocalStorage test:', test === 'working' ? 'WORKING' : 'FAILED');
            } catch (e) {
                console.error('LocalStorage error:', e);
            }
        }

        window.addEventListener('load', function () {
            console.log('Page loaded, calling loadFormData...');
            debugLocalStorage();
            loadFormData();
        });

        window.addEventListener('focus', function () {
            console.log('Page focused, refreshing status...');
            checkSubjectsStatus();
            checkFormComplete();
        });
    </script>

    <!-- Include shared UI functions -->
    <script src="assets/js/ui/shared-ui.js"></script>
    <!-- Mythology Effects -->
    <script src="assets/js/mythology-effects.js"></script>
    <script type="module">
        import { TeachersPetApp } from './assets/js/controllers/app-controller.js';
        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new TeachersPetApp();
        });
    </script>
</body>

</html>